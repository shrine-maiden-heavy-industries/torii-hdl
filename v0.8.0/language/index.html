
<!DOCTYPE html>

<html class="no-js" data-content_root="../" lang="en">
<head><meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="light dark" name="color-scheme"/><meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="Language Guide" property="og:title"/>
<meta content="website" property="og:type"/>
<meta content="https://torii.shmdn.link/language/index.html" property="og:url"/>
<meta content="Torii" property="og:site_name"/>
<meta content="This guide introduces the Torii language in depth. It assumes familiarity with synchronous digital logic and the Python programming language, but does not require prior experience with any hardware..." property="og:description"/>
<meta content="1146" property="og:image:width"/>
<meta content="600" property="og:image:height"/>
<meta content="https://torii.shmdn.link/_images/social_previews/summary_language_index_bd9042b1.png" property="og:image"/>
<meta content="This guide introduces the Torii language in depth. It assumes familiarity with synchronous digital logic and the Python programming language, but does not require prior experience with any hardware..." property="og:image:alt"/>
<meta content="This guide introduces the Torii language in depth. It assumes familiarity with synchronous digital logic and the Python programming language, but does not require prior experience with any hardware..." name="description"/>
<meta content="summary_large_image" name="twitter:card"/>
<link href="../genindex.html" rel="index" title="Index"/><link href="../search.html" rel="search" title="Search"/><link href="../api/index.html" rel="next" title="API Reference"/><link href="../tutorials/external_modules.html" rel="prev" title="Including External non-Torii Modules"/>
<link href="https://torii.shmdn.link/language/index.html" rel="canonical"/>
<!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
<title>Language Guide - Torii v0.8.0 Documentation</title>
<link href="../_static/pygments.css?v=b86133f3" rel="stylesheet" type="text/css"/>
<link href="../_static/styles/furo.css?v=25af2a20" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-codeautolink.css?v=b2176991" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../_static/tabs.css?v=4c969af8" rel="stylesheet" type="text/css"/>
<link href="../_static/styles/furo-extensions.css?v=8dab3a3b" rel="stylesheet" type="text/css"/>
<link href="../_static/css/styles.css?v=176f8baf" rel="stylesheet" type="text/css"/>
<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2672a8;
  --color-brand-content: #2672a8;
  --color-announcement-background: #ffab87;
  --color-announcement-text: #494453;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #85C2FE;
  --color-brand-content: #85C2FE;
  --color-announcement-background: #ffab87;
  --color-announcement-text: #494453;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #85C2FE;
  --color-brand-content: #85C2FE;
  --color-announcement-background: #ffab87;
  --color-announcement-text: #494453;
  
      }
    }
  }
</style></meta></head>
<body>
<script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<symbol id="svg-toc" viewbox="0 0 24 24">
<title>Contents</title>
<svg fill="currentColor" stroke="currentColor" stroke-width="0" viewbox="0 0 1024 1024">
<path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path>
</svg>
</symbol>
<symbol id="svg-menu" viewbox="0 0 24 24">
<title>Menu</title>
<svg class="feather-menu" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<line x1="3" x2="21" y1="12" y2="12"></line>
<line x1="3" x2="21" y1="6" y2="6"></line>
<line x1="3" x2="21" y1="18" y2="18"></line>
</svg>
</symbol>
<symbol id="svg-arrow-right" viewbox="0 0 24 24">
<title>Expand</title>
<svg class="feather-chevron-right" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</symbol>
<symbol id="svg-sun" viewbox="0 0 24 24">
<title>Light mode</title>
<svg class="feather-sun" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="5"></circle>
<line x1="12" x2="12" y1="1" y2="3"></line>
<line x1="12" x2="12" y1="21" y2="23"></line>
<line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
<line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
<line x1="1" x2="3" y1="12" y2="12"></line>
<line x1="21" x2="23" y1="12" y2="12"></line>
<line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
<line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
</svg>
</symbol>
<symbol id="svg-moon" viewbox="0 0 24 24">
<title>Dark mode</title>
<svg class="icon-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
</svg>
</symbol>
<symbol id="svg-sun-with-moon" viewbox="0 0 24 24">
<title>Auto light/dark, in light mode</title>
<svg class="icon-custom-derived-from-feather-sun-and-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z" style="opacity: 50%"></path>
<line x1="14.5" x2="14.5" y1="3.25" y2="1.25"></line>
<line x1="14.5" x2="14.5" y1="15.85" y2="17.85"></line>
<line x1="10.044" x2="8.63" y1="5.094" y2="3.68"></line>
<line x1="19" x2="20.414" y1="14.05" y2="15.464"></line>
<line x1="8.2" x2="6.2" y1="9.55" y2="9.55"></line>
<line x1="20.8" x2="22.8" y1="9.55" y2="9.55"></line>
<line x1="10.044" x2="8.63" y1="14.006" y2="15.42"></line>
<line x1="19" x2="20.414" y1="5.05" y2="3.636"></line>
<circle cx="14.5" cy="9.55" r="3.6"></circle>
</svg>
</symbol>
<symbol id="svg-moon-with-sun" viewbox="0 0 24 24">
<title>Auto light/dark, in dark mode</title>
<svg class="icon-custom-derived-from-feather-sun-and-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"></path>
<line style="opacity: 50%" x1="18" x2="18" y1="3.705" y2="2.5"></line>
<line style="opacity: 50%" x1="18" x2="18" y1="11.295" y2="12.5"></line>
<line style="opacity: 50%" x1="15.316" x2="14.464" y1="4.816" y2="3.964"></line>
<line style="opacity: 50%" x1="20.711" x2="21.563" y1="10.212" y2="11.063"></line>
<line style="opacity: 50%" x1="14.205" x2="13.001" y1="7.5" y2="7.5"></line>
<line style="opacity: 50%" x1="21.795" x2="23" y1="7.5" y2="7.5"></line>
<line style="opacity: 50%" x1="15.316" x2="14.464" y1="10.184" y2="11.036"></line>
<line style="opacity: 50%" x1="20.711" x2="21.563" y1="4.789" y2="3.937"></line>
<circle cx="18" cy="7.5" r="2.169" style="opacity: 50%"></circle>
</svg>
</symbol>
<symbol id="svg-pencil" viewbox="0 0 24 24">
<svg class="icon-tabler-pencil-code" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4"></path>
<path d="M13.5 6.5l4 4"></path>
<path d="M20 21l2 -2l-2 -2"></path>
<path d="M17 17l-2 2l2 2"></path>
</svg>
</symbol>
<symbol id="svg-eye" viewbox="0 0 24 24">
<svg class="icon-tabler-eye-code" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"></path>
<path d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008"></path>
<path d="M20 21l2 -2l-2 -2"></path>
<path d="M17 17l-2 2l2 2"></path>
</svg>
</symbol>
</svg>
<input class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<input class="sidebar-toggle" id="__toc" name="__toc" type="checkbox"/>
<label class="overlay sidebar-overlay" for="__navigation">
<div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
<div class="visually-hidden">Hide table of contents sidebar</div>
</label>
<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>
<div class="announcement multiver">
<aside class="announcement-content multiver-content">
<strong>
    
    This is an old version of the Torii documentation, for the stable <code>v0.8.1</code> docs <a href="../../v0.8.1/language/index.html">Click Here</a>.
    
    </strong>
</aside>
</div>
<div class="announcement">
<aside class="announcement-content">
     This documentation is a work in progress, and you can help us <a href="https://github.com/shrine-maiden-heavy-industries/torii-hdl/blob/main/CONTRIBUTING.md">improve it!</a>
</aside>
</div>
<div class="page">
<header class="mobile-header">
<div class="header-left">
<label class="nav-overlay-icon" for="__navigation">
<div class="visually-hidden">Toggle site navigation sidebar</div>
<i class="icon"><svg><use href="#svg-menu"></use></svg></i>
</label>
</div>
<div class="header-center">
<a href="../index.html"><div class="brand">Torii 0.8.1.dev365 documentation</div></a>
</div>
<div class="header-right">
<div class="theme-toggle-container theme-toggle-header">
<button class="theme-toggle">
<div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
<svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
<svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
<svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
<svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
</button>
</div>
<label class="toc-overlay-icon toc-header-icon" for="__toc">
<div class="visually-hidden">Toggle table of contents sidebar</div>
<i class="icon"><svg><use href="#svg-toc"></use></svg></i>
</label>
</div>
</header>
<aside class="sidebar-drawer">
<div class="sidebar-container">
<div class="sidebar-sticky">
<a class="sidebar-brand" href="../index.html">
<span class="sidebar-brand-text">Torii v0.8.0 Documentation</span>
</a><form action="../search.html" class="sidebar-search-container" method="get" role="search">
<input aria-label="Search" class="sidebar-search" name="q" placeholder="Search"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/external_modules.html">Including External non-Torii Modules</a></li>
</ul>
</input></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Language Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/backend/index.html">Torii Backends</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/hdl/index.html">Torii HDL Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Torii HDL Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/ast.html">Abstract Syntax Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/cd.html">Clock Domain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/dsl.html">DSL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/ir.html">IR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/mem.html">Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/rec.html">Records</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/hdl/xfrm.html">XFRM</a></li>
</ul>
</input></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/utility/index.html">Torii Utility Library</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Torii Utility Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/utility/string.html">String Helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utility/tracer.html">Tracer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/utility/units.html">Unit Helpers</a></li>
</ul>
</input></li>
</ul>
</input></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../library/index.html">Standard Library</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Standard Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library/bus/index.html">Busses</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Busses</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library/bus/wishbone.html">Wishbone Bus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library/coding/index.html">Encoding and Decoding</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library/mem/index.html">Memory</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Memory</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library/mem/map.html">Memory Map</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library/cdc.html">Clock Domain Crossing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../library/fifo.html">First-in First-out Queues</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library/soc/index.html">System on Chip</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of System on Chip</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library/soc/event.html">Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library/soc/periph.html">Peripherals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library/soc/csr/index.html">CSRs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../library/stdio/index.html">Industry Standard I/O</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library/stream/index.html">Stream Library</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Stream Library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library/stream/simple.html">Simple Streams</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../library/vendor/index.html">FPGA Vendor Modules</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of FPGA Vendor Modules</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../library/vendor/lattice/index.html">Lattice FPGA Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../library/vendor/xilinx/index.html">Xilinx FPGA Modules</a></li>
</ul>
</li>
</ul>
</input></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../platforms/index.html">Platform Integration</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Platform Integration</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../platforms/fpga/index.html">Torii FPGA Platforms</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Torii FPGA Platforms</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/gowin.html">Gowin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/altera.html">Altera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/lattice-ecp5.html">Lattice ECP5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/lattice-ice40.html">Lattice iCE40</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/lattice-machxo-2-3l.html">Lattice MachXO2 and MachXO3L</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/quicklogic.html">Quicklogic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../platforms/fpga/xilinx.html">Xilinx</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../testing/index.html">Testing and Verification</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Testing and Verification</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/simulation.html">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/formal.html">Formal Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../external_libraries.html">External Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide.html">Torii v0.X to v1.0 Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects.html">Projects Using Torii</a></li>
<li class="toctree-l1"><a class="reference external" href="https://shrine-maiden-heavy-industries.github.io/torii-boards/">Torii Boards</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/shrine-maiden-heavy-industries/torii-hdl/">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/shrine-maiden-heavy-industries/torii-hdl/blob/main/CONTRIBUTING.md">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
</div>
<div class="sidebar-tree">
<p class="caption" role="heading">
<span class="caption-text">Versions</span>
</p>
<a class="reference" href="../../main/language/index.html">Development</a>
<ul>
<li class="toctree-l1"><a class="reference" href="../../v0.8.1/language/index.html">v0.8.1</a></li>
<li class="toctree-l1"><a class="reference" href="index.html">v0.8.0</a></li>
</ul>
</div>
</div>
</div>
</div>
</aside>
<div class="main">
<div class="content">
<div class="article-container">
<a class="back-to-top muted-link" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
</svg>
<span>Back to top</span>
</a>
<div class="content-icon-container">
<div class="view-this-page">
<a class="muted-link" href="https://github.com/shrine-maiden-heavy-industries/torii-hdl/blob/main/docs/language/index.md?plain=true" title="View this page">
<svg><use href="#svg-eye"></use></svg>
<span class="visually-hidden">View this page</span>
</a>
</div><div class="edit-this-page">
<a class="muted-link" href="https://github.com/shrine-maiden-heavy-industries/torii-hdl/edit/main/docs/language/index.md" rel="edit" title="Edit this page">
<svg><use href="#svg-pencil"></use></svg>
<span class="visually-hidden">Edit this page</span>
</a>
</div><div class="theme-toggle-container theme-toggle-content">
<button class="theme-toggle">
<div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
<svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
<svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
<svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
<svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
</button>
</div>
<label class="toc-overlay-icon toc-content-icon" for="__toc">
<div class="visually-hidden">Toggle table of contents sidebar</div>
<i class="icon"><svg><use href="#svg-toc"></use></svg></i>
</label>
</div>
<article id="furo-main-content" role="main">
<section id="language-guide">
<h1>Language Guide<a class="headerlink" href="#language-guide" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This guide is a work in progress and is seriously incomplete!</p>
</div>
<p>This guide introduces the Torii language in depth. It assumes familiarity with synchronous digital logic and the Python programming language, but does not require prior experience with any hardware description language. See the <a class="reference internal" href="../tutorials/index.html"><span class="std std-doc">Tutorials</span></a> section for a step-by-step introduction to the language.</p>
<!-- TODO: link to a good synchronous logic tutorial and a Python tutorial? -->
<section id="the-prelude">
<h2>The prelude<a class="headerlink" href="#the-prelude" title="Link to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Glob imports are no longer considered good practice, as they make finding where things come from much more difficult, avoid if at all possible.</p>
</div>
<p>Because Torii is a regular Python library, it needs to be imported before use. The root <code class="docutils literal notranslate"><span class="pre">torii</span></code> module, called <em>the prelude</em>, is carefully curated to export a small amount of the most essential names, useful in nearly every design. In source files dedicated to Torii code, it is a good practice to use a <a class="reference external" href="https://docs.python.org/3/tutorial/modules.html#tut-pkg-import-star" title="(in Python v3.13)"><span class="xref std std-ref">glob import</span></a> for readability:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">torii.hdl</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>However, if a source file uses Torii together with other libraries, or if glob imports are frowned upon, it is conventional to use a short alias instead:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torii.hdl</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tr</span>
</pre></div>
</div>
<p>All of the examples below assume that a glob import is used.</p>
</section>
<section id="shapes">
<h2>Shapes<a class="headerlink" href="#shapes" title="Link to this heading">¶</a></h2>
<p>A <a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Shape" title="torii.hdl.ast.Shape"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shape</span></code></a> is an object with two attributes, <code class="docutils literal notranslate"><span class="pre">.width</span></code> and <code class="docutils literal notranslate"><span class="pre">.signed</span></code>. It can be constructed directly:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Shape" title="torii.hdl.ast.Shape"><span class="n">Shape</span></a><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">unsigned(5)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Shape" title="torii.hdl.ast.Shape"><span class="n">Shape</span></a><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">signed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="go">signed(12)</span>
</pre></div>
</div>
<p>However, in most cases, the shape is always constructed with the same signedness, and the aliases <a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.signed" title="torii.hdl.ast.signed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">signed</span></code></a> and <a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.unsigned" title="torii.hdl.ast.unsigned"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unsigned</span></code></a> are more convenient:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.unsigned" title="torii.hdl.ast.unsigned"><span class="n">unsigned</span></a><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Shape" title="torii.hdl.ast.Shape"><span class="n">Shape</span></a><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">signed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">==</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Shape" title="torii.hdl.ast.Shape"><span class="n">Shape</span></a><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.signed" title="torii.hdl.ast.signed"><span class="n">signed</span></a> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="shapes-of-values">
<h2>Shapes of values<a class="headerlink" href="#shapes-of-values" title="Link to this heading">¶</a></h2>
<p>All values have a <code class="docutils literal notranslate"><span class="pre">.shape()</span></code> method that computes their shape. The width of a value <code class="docutils literal notranslate"><span class="pre">v</span></code>, <code class="docutils literal notranslate"><span class="pre">v.shape().width</span></code>, can also be retrieved with <code class="docutils literal notranslate"><span class="pre">len(v)</span></code>.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(3)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="go">3</span>
</pre></div>
</div>
</section>
<section id="values">
<h2>Values<a class="headerlink" href="#values" title="Link to this heading">¶</a></h2>
<p>The basic building block of the Torii language is a <em>value</em>, which is a term for a binary number that is computed or stored anywhere in the design. Each value has a <em>width</em>—the amount of bits used to represent the value—and a <em>signedness</em>—the interpretation of the value by arithmetic operations—collectively called its <em>shape</em>. Signed values always use <a class="reference external" href="https://en.wikipedia.org/wiki/Two's_complement" rel="noreferer noopener" target="_blank">two’s complement</a> representation.</p>
</section>
<section id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Link to this heading">¶</a></h2>
<p>The simplest Torii value is a <em>constant</em>, representing a fixed number, and introduced using <a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><code class="xref py py-class docutils literal notranslate"><span class="pre">Const(...)</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">ten</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">minus_two</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The code above does not specify any shape for the constants. If the shape is omitted, Torii uses unsigned shape for positive numbers and signed shape for negative numbers, with the width inferred from the smallest amount of bits necessary to represent the number. As a special case, in order to get the same inferred shape for <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code> is considered to be 1-bit unsigned.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">ten</span><span class="o">.</span><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(4)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">minus_two</span><span class="o">.</span><span class="n">shape</span></a><span class="p">()</span>
<span class="go">signed(2)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(1)</span>
</pre></div>
</div>
<p>The shape of the constant can be specified explicitly, in which case the number’s binary representation will be truncated or extended to fit the shape. Although rarely useful, 0-bit constants are permitted.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">360</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.unsigned" title="torii.hdl.ast.unsigned"><span class="n">unsigned</span></a><span class="p">(</span><span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
<span class="go">104</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">129</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.signed" title="torii.hdl.ast.signed"><span class="n">signed</span></a><span class="p">(</span><span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
<span class="go">-127</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.unsigned" title="torii.hdl.ast.unsigned"><span class="n">unsigned</span></a><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
<span class="go">0</span>
</pre></div>
</div>
</section>
<section id="shape-casting">
<h2>Shape casting<a class="headerlink" href="#shape-casting" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Shape" title="torii.hdl.ast.Shape"><code class="xref py py-class docutils literal notranslate"><span class="pre">Shape</span></code></a>s can be <em>cast</em> from other objects, which are called <em>shape-castable</em>. Casting is a convenient way to specify a shape indirectly, for example, by a range of numbers representable by values with that shape.</p>
<p>Casting to a shape can be done explicitly with <code class="docutils literal notranslate"><span class="pre">Shape.cast</span></code>, but is usually implicit, since shape-castable objects are accepted anywhere shapes are.</p>
<section id="shapes-from-integers">
<h3>Shapes from integers<a class="headerlink" href="#shapes-from-integers" title="Link to this heading">¶</a></h3>
<p>Casting a shape from an integer <code class="docutils literal notranslate"><span class="pre">i</span></code> is a shorthand for constructing a shape with <code class="docutils literal notranslate"><span class="pre">unsigned(i)</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Shape</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">unsigned(5)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(3)</span>
</pre></div>
</div>
</section>
<section id="shapes-from-ranges">
<h3>Shapes from ranges<a class="headerlink" href="#shapes-from-ranges" title="Link to this heading">¶</a></h3>
<p>Casting a shape from a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#range" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a> <code class="docutils literal notranslate"><span class="pre">r</span></code> produces a shape that:</p>
<ul class="simple">
<li><p>has a width large enough to represent both <code class="docutils literal notranslate"><span class="pre">min(r)</span></code> and <code class="docutils literal notranslate"><span class="pre">max(r)</span></code>, but not larger, and</p></li>
<li><p>is signed if <code class="docutils literal notranslate"><span class="pre">r</span></code> contains any negative values, unsigned otherwise.</p></li>
</ul>
<p>Specifying a shape with a range is convenient for counters, indexes, and all other values whose width is derived from a set of numbers they must be able to fit:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(7)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#len" title="len"><span class="nb">len</span></a><span class="p">(</span><span class="n">items</span><span class="p">)))</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(2)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Python ranges are <em>exclusive</em> or <em>half-open</em>, meaning they do not contain their <code class="docutils literal notranslate"><span class="pre">.stop</span></code> element. Because of this, values with shapes cast from a <code class="docutils literal notranslate"><span class="pre">range(stop)</span></code> where <code class="docutils literal notranslate"><span class="pre">stop</span></code> is a power of 2 are not wide enough to represent <code class="docutils literal notranslate"><span class="pre">stop</span></code> itself:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">fencepost</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.shape" title="torii.hdl.ast.Const.shape"><span class="n">fencepost</span><span class="o">.</span><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fencepost</span><span class="o">.</span><span class="n">value</span>
<span class="go">0</span>
</pre></div>
</div>
<p>This is detected in <code class="xref py py-class docutils literal notranslate"><span class="pre">Const</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code> when invoked with a suspected off-by-one error, which then emits a diagnostic message.</p>
</div>
</section>
<section id="shapes-from-enumerations">
<h3>Shapes from enumerations<a class="headerlink" href="#shapes-from-enumerations" title="Link to this heading">¶</a></h3>
<p>Casting a shape from an <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a> subclass <code class="docutils literal notranslate"><span class="pre">E</span></code>:</p>
<ul class="simple">
<li><p>fails if any of the enumeration members have non-integer values,</p></li>
<li><p>has a width large enough to represent both <code class="docutils literal notranslate"><span class="pre">min(m.value</span> <span class="pre">for</span> <span class="pre">m</span> <span class="pre">in</span> <span class="pre">E)</span></code> and <code class="docutils literal notranslate"><span class="pre">max(m.value</span> <span class="pre">for</span> <span class="pre">m</span> <span class="pre">in</span> <span class="pre">E)</span></code>, and</p></li>
<li><p>is signed if either <code class="docutils literal notranslate"><span class="pre">min(m.value</span> <span class="pre">for</span> <span class="pre">m</span> <span class="pre">in</span> <span class="pre">E)</span></code> or <code class="docutils literal notranslate"><span class="pre">max(m.value</span> <span class="pre">for</span> <span class="pre">m</span> <span class="pre">in</span> <span class="pre">E)</span></code> are negative, unsigned otherwise.</p></li>
</ul>
<p>Specifying a shape with an enumeration is convenient for finite state machines, multiplexers, complex control signals, and all other values whose width is derived from a few distinct choices they must be able to fit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Direction</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">TOP</span>    <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LEFT</span>   <span class="o">=</span> <span class="mi">1</span>
    <span class="n">BOTTOM</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">RIGHT</span>  <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Shape</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Direction</span><span class="p">)</span>
<span class="go">unsigned(2)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The enumeration does not have to subclass <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a>; it only needs to have integers as values of every member. Using enumerations based on <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a> rather than <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a> prevents unwanted implicit conversion of enum members to integers.</p>
</div>
</section>
</section>
<section id="value-casting">
<span id="lang-valuelike"></span><h2>Value casting<a class="headerlink" href="#value-casting" title="Link to this heading">¶</a></h2>
<p>Like shapes, values may be <em>cast</em> from other objects, which are called <em>value-castable</em>. Casting to values allows objects that are not provided by Torii, such as integers or enumeration members, to be used in Torii expressions directly.</p>
<!-- TODO: link to ValueCastable -->
<p>Casting to a value can be done explicitly with <code class="docutils literal notranslate"><span class="pre">Value.cast</span></code>, but is usually implicit, since value-castable objects are accepted anywhere values are.</p>
<section id="values-from-integers">
<h3>Values from integers<a class="headerlink" href="#values-from-integers" title="Link to this heading">¶</a></h3>
<p>Casting a value from an integer <code class="docutils literal notranslate"><span class="pre">i</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">Const(i)</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Value</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">(const 3'd5)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a value subclasses <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a> or its class otherwise inherits from both <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a>, it is treated as an enumeration.</p>
</div>
</section>
<section id="values-from-enumeration-members">
<h3>Values from enumeration members<a class="headerlink" href="#values-from-enumeration-members" title="Link to this heading">¶</a></h3>
<p>Casting a value from an enumeration member <code class="docutils literal notranslate"><span class="pre">m</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">Const(m.value,</span> <span class="pre">type(m))</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Value</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Direction</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span>
<span class="go">(const 2'd1)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a value subclasses <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a> or its class otherwise inherits from both <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a>, it is treated as an enumeration.</p>
</div>
</section>
</section>
<section id="constant-casting">
<h2>Constant casting<a class="headerlink" href="#constant-casting" title="Link to this heading">¶</a></h2>
<p>A subset of <a class="reference internal" href="#values">values</a> are <em>constant-castable</em>. If a value is constant-castable and all of its operands are also constant-castable, it can be converted to a <code class="docutils literal notranslate"><span class="pre">Const</span></code>, the numeric value of which can then be read by Python code. This provides a way to perform computation on Torii values while constructing the design.</p>
<!-- link to m.Case and v.matches() below -->
<p>Constant-castable objects are accepted anywhere a constant integer is accepted. Casting to a constant can also be done explicitly with <code class="docutils literal notranslate"><span class="pre">Const.cast</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const.cast" title="torii.hdl.ast.Const.cast"><span class="n">Const</span><span class="o">.</span><span class="n">cast</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><span class="n">Direction</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="n">Direction</span><span class="o">.</span><span class="n">LEFT</span><span class="p">))</span>
<span class="go">(const 4'd4)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At the moment, only the following expressions are constant-castable:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><code class="xref py py-class docutils literal notranslate"><span class="pre">Const</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cat</span></code></a></p></li>
</ul>
<p>This list will be expanded in the future.</p>
</div>
</section>
<section id="signals">
<h2>Signals<a class="headerlink" href="#signals" title="Link to this heading">¶</a></h2>
<p>A <a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code></a> is a value representing a (potentially) varying number. Signals can be <a class="reference internal" href="#assigning-to-signals"><em>assigned</em></a> in a <a class="reference internal" href="#combinatorial-evaluation">combinatorial</a> or <a class="reference internal" href="#synchronous-evaluation">synchronous</a> domain, in which case they are generated as wires or registers, respectively. Signals always have a well-defined value; they cannot be uninitialized or undefined.</p>
<section id="signal-shapes">
<h3>Signal shapes<a class="headerlink" href="#signal-shapes" title="Link to this heading">¶</a></h3>
<p>A signal can be created with an explicitly specified shape (any <a class="reference internal" href="#shape-casting">shape-castable</a> object); if omitted, the shape defaults to <code class="docutils literal notranslate"><span class="pre">unsigned(1)</span></code>. Although rarely useful, 0-bit signals are permitted.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal.shape" title="torii.hdl.ast.Signal.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(1)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal.shape" title="torii.hdl.ast.Signal.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(4)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal.shape" title="torii.hdl.ast.Signal.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">signed(4)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="n">Direction</span><span class="p">)</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal.shape" title="torii.hdl.ast.Signal.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(2)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal.shape" title="torii.hdl.ast.Signal.shape"><span class="n">shape</span></a><span class="p">()</span>
<span class="go">unsigned(0)</span>
</pre></div>
</div>
</section>
<section id="signal-names">
<h3>Signal names<a class="headerlink" href="#signal-names" title="Link to this heading">¶</a></h3>
<p>Each signal has a <em>name</em>, which is used in the waveform viewer, diagnostic messages, Verilog output, and so on. In most cases, the name is omitted and inferred from the name of the variable or attribute the signal is placed into:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">foo</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">name</span>
<span class="go">'foo'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">name</span>
<span class="go">'bar'</span>
</pre></div>
</div>
<p>However, the name can also be specified explicitly with the <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">foo2</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'second_foo'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo2</span><span class="o">.</span><span class="n">name</span>
<span class="go">'second_foo'</span>
</pre></div>
</div>
<p>The names do not need to be unique; if two signals with the same name end up in the same namespace while preparing for simulation or synthesis, one of them will be renamed to remove the ambiguity.</p>
</section>
<section id="initial-signal-values">
<h3>Initial signal values<a class="headerlink" href="#initial-signal-values" title="Link to this heading">¶</a></h3>
<p>Each signal has an <em>initial value</em>, specified with the <code class="docutils literal notranslate"><span class="pre">reset</span></code> parameter. If the initial value is not specified explicitly, zero is used by default. An initial value can be specified with an integer or an enumeration member.</p>
<p>Signals <a class="reference internal" href="#assigning-to-signals">assigned</a> in a <a class="reference internal" href="#combinatorial-evaluation">combinatorial</a> domain assume their initial value when none of the assignments are <a class="reference internal" href="#active-and-inactive-assignments">active</a>. Signals assigned in a <a class="reference internal" href="#synchronous-evaluation">synchronous</a> domain assume their initial value after <em>power-on reset</em> and, unless the signal is <a class="reference internal" href="#reset-less-signals">reset-less</a>, <em>explicit reset</em>. Signals that are used but never assigned are equivalent to constants of their initial value.</p>
<!-- TODO: using "reset" for "initial value" is awful, let's rename it to "init" -->
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reset</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">reset</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="n">Direction</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="n">Direction</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span><span class="o">.</span><span class="n">reset</span>
<span class="go">1</span>
</pre></div>
</div>
</section>
<section id="reset-less-signals">
<h3>Reset-less signals<a class="headerlink" href="#reset-less-signals" title="Link to this heading">¶</a></h3>
<p>Signals assigned in a <a class="reference internal" href="#synchronous-evaluation">synchronous</a> domain can be <em>resettable</em> or <em>reset-less</em>, specified with the <code class="docutils literal notranslate"><span class="pre">reset_less</span></code> parameter. If the parameter is not specified, signals are resettable by default. Resettable signals assume their <a class="reference internal" href="#initial-signal-values">initial value</a> on explicit reset, which can be asserted via the clock domain or by using <a class="reference internal" href="../api/hdl/xfrm.html#torii.hdl.xfrm.ResetInserter" title="torii.hdl.xfrm.ResetInserter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResetInserter</span></code></a>. Reset-less signals are not affected by explicit reset.</p>
<!-- TODO: link to clock domain and ResetInserter docs -->
<p>Signals assigned in a <a class="reference internal" href="#combinatorial-evaluation">combinatorial</a> domain are not affected by the <code class="docutils literal notranslate"><span class="pre">reset_less</span></code> parameter.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span><span class="o">.</span><span class="n">reset_less</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="n">reset_less</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_less</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
</section>
<section id="operators">
<h2>Operators<a class="headerlink" href="#operators" title="Link to this heading">¶</a></h2>
<p>To describe computations, Torii values can be combined with each other or with <a class="reference internal" href="#value-casting">value-castable</a> objects using a rich array of arithmetic, bitwise, logical, bit sequence, and other <em>operators</em> to form <em>expressions</em>, which are themselves values.</p>
<section id="performing-or-describing-computations">
<h3>Performing or describing computations?<a class="headerlink" href="#performing-or-describing-computations" title="Link to this heading">¶</a></h3>
<p>Code written in the Python language <em>performs</em> computations on concrete objects, like integers, with the goal of calculating a concrete result:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">6</span>
</pre></div>
</div>
<p>In contrast, code written in the Torii language <em>describes</em> computations on abstract objects, like <a class="reference internal" href="#signals">signals</a>, with the goal of generating a hardware <em>circuit</em> that can be simulated, synthesized, and so on. Torii expressions are ordinary Python objects that represent parts of this circuit:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">+</span> <span class="mi">1</span>
<span class="go">(+ (sig a) (const 1'd1))</span>
</pre></div>
</div>
<p>Although the syntax is similar, it is important to remember that Torii values exist on a higher level of abstraction than Python values. For example, expressions that include Torii values cannot be used in Python control flow structures:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>    <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="s1">'Zero!'</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">Attempted to convert Torii value to Python boolean</span>
</pre></div>
</div>
<p>Because the value of <code class="docutils literal notranslate"><span class="pre">a</span></code>, and therefore <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">0</span></code>, is not known at the time when the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement is executed, there is no way to decide whether the body of the statement should be executed—in fact, if the design is synthesized, by the time <code class="docutils literal notranslate"><span class="pre">a</span></code> has any concrete value, the Python program has long finished! To solve this problem, Torii provides its own <a class="reference internal" href="#control-structures">control structures</a> that, also, manipulate circuits.</p>
</section>
<section id="width-extension">
<h3>Width extension<a class="headerlink" href="#width-extension" title="Link to this heading">¶</a></h3>
<p>Many of the operations described below (for example, addition, equality, bitwise OR, and part select) extend the width of one or both operands to match the width of the expression. When this happens, unsigned values are always zero-extended and signed values are always sign-extended regardless of the operation or signedness of the result.</p>
</section>
<section id="arithmetic-operators">
<h3>Arithmetic operators<a class="headerlink" href="#arithmetic-operators" title="Link to this heading">¶</a></h3>
<p>Most arithmetic operations on integers provided by Python can be used on Torii values, too.</p>
<p>Although Python integers have unlimited precision and Torii values are represented with a <a class="reference internal" href="#values">finite amount of bits</a>, arithmetics on Torii values never overflows because the width of the arithmetic expression is always sufficient to represent all possible results.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> <span class="c1"># needs to represent 1 to 256</span>
<span class="go">unsigned(9)</span>
</pre></div>
</div>
<p>Similarly, although Python integers are always signed and Torii values can be either <a class="reference internal" href="#values">signed or unsigned</a>, if any of the operands of an Torii arithmetic expression is signed, the expression itself is also signed, matching the behavior of Python.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.unsigned" title="torii.hdl.ast.unsigned"><span class="n">unsigned</span></a><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.signed" title="torii.hdl.ast.signed"><span class="n">signed</span></a><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">+</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span> <span class="c1"># needs to represent -128 to 382</span>
<span class="go">signed(10)</span>
</pre></div>
</div>
<p>While arithmetic computations never result in an overflow, <a class="reference internal" href="#assigning-to-signals">assigning</a>  their results to signals may truncate the most significant bits.</p>
<p>The following table lists the arithmetic operations provided by Torii:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code></p></td>
<td><p>addition</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-a</span></code></p></td>
<td><p>negation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-</span> <span class="pre">b</span></code></p></td>
<td><p>subtraction</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">b</span></code></p></td>
<td><p>multiplication</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">//</span> <span class="pre">b</span></code></p></td>
<td><p>floor division</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">%</span> <span class="pre">b</span></code></p></td>
<td><p>modulo</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abs(a)</span></code></p></td>
<td><p>absolute value</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="comparison-operators">
<h3>Comparison operators<a class="headerlink" href="#comparison-operators" title="Link to this heading">¶</a></h3>
<p>All comparison operations on integers provided by Python can be used on Torii values. However, due to a limitation of Python, chained comparisons (e.g. <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;</span> <span class="pre">b</span> <span class="pre">&lt;</span> <span class="pre">c</span></code>) cannot be used.</p>
<p>Similar to arithmetic operations, if any operand of a comparison expression is signed, a signed comparison is performed. The result of a comparison is a 1-bit unsigned value.</p>
<p>The following table lists the comparison operations provided by Torii:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code></p></td>
<td><p>equality</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">!=</span> <span class="pre">b</span></code></p></td>
<td><p>inequality</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;</span> <span class="pre">b</span></code></p></td>
<td><p>less than</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;=</span> <span class="pre">b</span></code></p></td>
<td><p>less than or equal</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code></p></td>
<td><p>greater than</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;=</span> <span class="pre">b</span></code></p></td>
<td><p>greater than or equal</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="bitwise-shift-and-rotate-operators">
<h3>Bitwise, shift, and rotate operators<a class="headerlink" href="#bitwise-shift-and-rotate-operators" title="Link to this heading">¶</a></h3>
<p>All bitwise and shift operations on integers provided by Python can be used on Torii values as well.</p>
<p>Similar to arithmetic operations, if any operand of a bitwise expression is signed, the expression itself is signed as well. A shift expression is signed if the shifted value is signed. A rotate expression is always unsigned.</p>
<p>Rotate operations with variable rotate amounts cannot be efficiently synthesized for non-power-of-2 widths of the rotated value. Because of that, the rotate operations are only provided for constant rotate amounts, specified as Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>s.</p>
<p>The following table lists the bitwise and shift operations provided by Torii:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">~a</span></code></p></td>
<td><p>bitwise NOT; complement</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&amp;</span> <span class="pre">b</span></code></p></td>
<td><p>bitwise AND</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">|</span> <span class="pre">b</span></code></p></td>
<td><p>bitwise OR</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">^</span> <span class="pre">b</span></code></p></td>
<td><p>bitwise XOR</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.implies(b)</span></code></p></td>
<td><p>bitwise <a class="reference external" href="https://en.wikipedia.org/wiki/IMPLY_gate" rel="noreferer noopener" target="_blank">IMPLY</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;&gt;</span> <span class="pre">b</span></code></p></td>
<td><p>arithmetic right shift by variable amount <a class="footnote-reference brackets" href="#id8" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#id9" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&lt;&lt;</span> <span class="pre">b</span></code></p></td>
<td><p>left shift by variable amount <a class="footnote-reference brackets" href="#id9" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.rotate_left(i)</span></code></p></td>
<td><p>left rotate by constant amount <a class="footnote-reference brackets" href="#id10" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.rotate_right(i)</span></code></p></td>
<td><p>right rotate by constant amount <a class="footnote-reference brackets" href="#id10" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.shift_left(i)</span></code></p></td>
<td><p>left shift by constant amount <a class="footnote-reference brackets" href="#id10" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.shift_right(i)</span></code></p></td>
<td><p>right shift by constant amount <a class="footnote-reference brackets" href="#id10" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because Torii ensures that the width of a variable left shift expression is wide enough to represent any possible result, variable left shift by a wide amount produces exponentially wider intermediate values, stressing the synthesis tools:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
<span class="go">unsigned(4294967296)</span>
</pre></div>
</div>
<p>Although Torii will detect and reject expressions wide enough to break other tools, it is a good practice to explicitly limit the width of a shift amount in a variable left shift.</p>
</div>
</section>
<section id="reduction-operators">
<h3>Reduction operators<a class="headerlink" href="#reduction-operators" title="Link to this heading">¶</a></h3>
<p>Bitwise reduction operations on integers are not provided by Python, but are very useful for hardware. They are similar to bitwise operations applied “sideways”; for example, if bitwise AND is a binary operator that applies AND to each pair of bits between its two operands, then reduction AND is an unary operator that applies AND to all of the bits in its sole operand.</p>
<p>The result of a reduction is a 1-bit unsigned value.</p>
<p>The following table lists the reduction operations provided by Torii:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.all()</span></code></p></td>
<td><p>reduction AND; are all bits set? <a class="footnote-reference brackets" href="#id14" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.any()</span></code></p></td>
<td><p>reduction OR; is any bit set? <a class="footnote-reference brackets" href="#id14" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.xor()</span></code></p></td>
<td><p>reduction XOR; is an odd number of bits set?</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.bool()</span></code></p></td>
<td><p>conversion to boolean; is non-zero? <a class="footnote-reference brackets" href="#id15" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="logical-operators">
<h3>Logical operators<a class="headerlink" href="#logical-operators" title="Link to this heading">¶</a></h3>
<p>Unlike the arithmetic or bitwise operators, it is not possible to change the behavior of the Python logical operators <code class="docutils literal notranslate"><span class="pre">not</span></code>, <code class="docutils literal notranslate"><span class="pre">and</span></code>, and <code class="docutils literal notranslate"><span class="pre">or</span></code>. Due to that, logical expressions in Torii are written using bitwise operations on boolean (1-bit unsigned) values, with explicit boolean conversions added where necessary.</p>
<p>The following table lists the Python logical expressions and their Torii equivalents:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Python expression</p></th>
<th class="head"><p>Torii expression (any operands)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">a</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">~(a).bool()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">and</span> <span class="pre">b</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(a).bool()</span> <span class="pre">&amp;</span> <span class="pre">(b).bool()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">or</span> <span class="pre">b</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(a).bool()</span> <span class="pre">|</span> <span class="pre">(b).bool()</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>When the operands are known to be boolean values, such as comparisons, reductions, or boolean signals, the <code class="docutils literal notranslate"><span class="pre">.bool()</span></code> conversion may be omitted for clarity:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Python expression</p></th>
<th class="head"><p>Torii expression (boolean operands)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">p</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">~(p)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">and</span> <span class="pre">q</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(p)</span> <span class="pre">&amp;</span> <span class="pre">(q)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">or</span> <span class="pre">q</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(p)</span> <span class="pre">|</span> <span class="pre">(q)</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Because of Python <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#operator-summary" title="(in Python v3.13)"><span class="xref std std-ref">operator precedence</span></a>, logical operators bind less tightly than comparison operators whereas bitwise operators bind more tightly than comparison operators. As a result, all logical expressions in Torii <strong>must</strong> have parenthesized operands.</p>
<p>Omitting parentheses around operands in an Torii a logical expression is likely to introduce a subtle bug:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">en</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">addr</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">en</span></a> <span class="o">&amp;</span> <span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">addr</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># correct</span>
<span class="go">(&amp; (sig en) (== (sig addr) (const 1'd0)))</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">en</span></a> <span class="o">&amp;</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">addr</span></a> <span class="o">==</span> <span class="mi">0</span> <span class="c1"># WRONG! addr is truncated to 1 bit</span>
<span class="go">(== (&amp; (sig en) (sig addr)) (const 1'd0))</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When applied to Torii boolean values, the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator computes negation, and when applied to Python boolean values, the <code class="docutils literal notranslate"><span class="pre">not</span></code> operator also computes negation. However, the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator applied to Python boolean values produces an unexpected result:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">~</span><span class="kc">False</span>
<span class="go">-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">~</span><span class="kc">True</span>
<span class="go">-2</span>
</pre></div>
</div>
<p>Because of this, Python booleans used in Torii logical expressions <strong>must</strong> be negated with the <code class="docutils literal notranslate"><span class="pre">not</span></code> operator, not the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator. Negating a Python boolean with the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator in an Torii logical expression is likely to introduce a subtle bug:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">stb</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">use_stb</span> <span class="o">=</span> <span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="ow">not</span> <span class="n">use_stb</span><span class="p">)</span> <span class="o">|</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">stb</span></a> <span class="c1"># correct</span>
<span class="go">(| (const 1'd0) (sig stb))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">~</span><span class="n">use_stb</span> <span class="o">|</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">stb</span></a> <span class="c1"># WRONG! MSB of 2-bit wide OR expression is always 1</span>
<span class="go">(| (const 2'sd-2) (sig stb))</span>
</pre></div>
</div>
<p>Torii automatically detects some cases of misuse of <code class="docutils literal notranslate"><span class="pre">~</span></code> and emits a detailed diagnostic message.</p>
</div>
</section>
<section id="bit-sequence-operators">
<h3>Bit sequence operators<a class="headerlink" href="#bit-sequence-operators" title="Link to this heading">¶</a></h3>
<p>Apart from acting as numbers, Torii values can also be treated as bit <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#typesseq" title="(in Python v3.13)"><span class="xref std std-ref">sequences</span></a>, supporting slicing, concatenation, replication, and other sequence operations. Since some of the operators Python defines for sequences clash with the operators it defines for numbers, Torii gives these operators a different name. Except for the names, Torii values follow Python sequence semantics, with the least significant bit at index 0.</p>
<p>Because every Torii value has a single fixed width, bit slicing and replication operations require the subscripts and count to be constant, specified as Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>s. It is often useful to slice a value with a constant width and variable offset, but this cannot be expressed with the Python slice notation. To solve this problem, Torii provides additional <em>part select</em> operations with the necessary semantics.</p>
<p>The result of any bit sequence operation is an unsigned value.</p>
<p>The following table lists the bit sequence operations provided by Torii:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Operation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">len(a)</span></code></p></td>
<td><p>bit length; value width <a class="footnote-reference brackets" href="#id19" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a[i:j:k]</span></code></p></td>
<td><p>bit slicing by constant subscripts <a class="footnote-reference brackets" href="#id20" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iter(a)</span></code></p></td>
<td><p>bit iteration</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.bit_select(b,</span> <span class="pre">w)</span></code></p></td>
<td><p>overlapping part select with variable offset</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.word_select(b,</span> <span class="pre">w)</span></code></p></td>
<td><p>non-overlapping part select with variable offset</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Cat(a,</span> <span class="pre">b,</span> <span class="pre">...)</span></code></p></td>
<td><p>concatenation <a class="footnote-reference brackets" href="#id21" id="id18" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.replicate(n)</span></code></p></td>
<td><p>replication</p></td>
</tr>
</tbody>
</table>
</div>
<p>For the operators introduced by Torii, the following table explains them in terms of Python code operating on tuples of bits rather than Torii values:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Torii operation</p></th>
<th class="head"><p>Equivalent Python code</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Cat(a,</span> <span class="pre">b)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.replicate(n)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">n</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a.bit_select(b,</span> <span class="pre">w)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[b:b+w]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">a.word_select(b,</span> <span class="pre">w)</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">a[b*w:b*w+w]</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In Python, the digits of a number are written right-to-left (0th exponent at the right), and the elements of a sequence are written left-to-right (0th element at the left). This mismatch can cause confusion when numeric operations (like shifts) are mixed with bit sequence operations (like concatenations). For example, <code class="docutils literal notranslate"><span class="pre">Cat(Const(0b1001),</span> <span class="pre">Const(0b1010))</span></code> has the same value as <code class="docutils literal notranslate"><span class="pre">Const(0b1010_1001)</span></code>, <code class="docutils literal notranslate"><span class="pre">val[4:]</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">val</span> <span class="pre">&gt;&gt;</span> <span class="pre">4</span></code>, and <code class="docutils literal notranslate"><span class="pre">val[-1]</span></code> refers to the most significant bit.</p>
<p>Such confusion can often be avoided by not using numeric and bit sequence operations in the same expression. For example, although it may seem natural to describe a shift register with a numeric shift and a sequence slice operations, using sequence operations alone would make it easier to understand.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Could Torii have used a different indexing or iteration order for values? Yes, but it would be necessary to either place the most significant bit at index 0, or deliberately break the Python sequence type interface. Both of these options would cause more issues than using different iteration orders for numeric and sequence operations.</p>
</div>
</section>
<section id="conversion-operators">
<h3>Conversion operators<a class="headerlink" href="#conversion-operators" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">.as_signed()</span></code> and <code class="docutils literal notranslate"><span class="pre">.as_unsigned()</span></code> conversion operators reinterpret the bits of a value with the requested signedness. This is useful when the same value is sometimes treated as signed and sometimes as unsigned, or when a signed value is constructed using slices or concatenations. For example, <code class="docutils literal notranslate"><span class="pre">(pc</span> <span class="pre">+</span> <span class="pre">imm[:7].as_signed()).as_unsigned()</span></code> sign-extends the 7 least significant bits of <code class="docutils literal notranslate"><span class="pre">imm</span></code> to the width of <code class="docutils literal notranslate"><span class="pre">pc</span></code>, performs the addition, and produces an unsigned result.</p>
</section>
<section id="choice-operator">
<h3>Choice operator<a class="headerlink" href="#choice-operator" title="Link to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../api/hdl/ast.html#torii.hdl.ast.Mux" title="torii.hdl.ast.Mux"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mux(sel,</span> <span class="pre">val1,</span> <span class="pre">val0)</span></code></a> choice expression (similar to the <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#if-expr" title="(in Python v3.13)"><span class="xref std std-ref">conditional expression</span></a> in Python) is equal to the operand <code class="docutils literal notranslate"><span class="pre">val1</span></code> if <code class="docutils literal notranslate"><span class="pre">sel</span></code> is non-zero, and to the other operand <code class="docutils literal notranslate"><span class="pre">val0</span></code> otherwise. If any of <code class="docutils literal notranslate"><span class="pre">val1</span></code> or <code class="docutils literal notranslate"><span class="pre">val0</span></code> are signed, the expression itself is signed as well.</p>
</section>
</section>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Link to this heading">¶</a></h2>
<p>A <em>module</em> is a unit of the Torii design hierarchy: the smallest collection of logic that can be independently simulated, synthesized, or otherwise processed. Modules associate signals with <a class="reference internal" href="#control-domains">control domains</a>, provide <a class="reference internal" href="#control-structures">control structures</a>, manage clock domains, and aggregate submodules.</p>
<!-- TODO: link to clock domains -->
<!-- TODO: link to submodules -->
<p>Every Torii design starts with a fresh module:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>
</pre></div>
</div>
<section id="control-domains">
<h3>Control domains<a class="headerlink" href="#control-domains" title="Link to this heading">¶</a></h3>
<p>A <em>control domain</em> is a named group of <a class="reference internal" href="#signals">signals</a> that change their value in identical conditions.</p>
<p>All designs have a single predefined <em>combinatorial domain</em>, containing all signals that change immediately when any value used to compute them changes. The name <code class="docutils literal notranslate"><span class="pre">comb</span></code> is reserved for the combinatorial domain.</p>
<p>A design can also have any amount of user-defined <em>synchronous domains</em>, also called <em>clock domains</em>, containing signals that change when a specific edge occurs on the domain’s clock signal or, for domains with asynchronous reset, on the domain’s reset signal. Most modules only use a single synchronous domain, conventionally called <code class="docutils literal notranslate"><span class="pre">sync</span></code>, but the name <code class="docutils literal notranslate"><span class="pre">sync</span></code> does not have to be used, and lacks any special meaning beyond being the default.</p>
<p>The behavior of assignments differs for signals in <a class="reference internal" href="#combinatorial-evaluation">combinatorial</a> and <a class="reference internal" href="#synchronous-evaluation">synchronous</a> domains. Collectively, signals in synchronous domains contain the state of a design, whereas signals in the combinatorial domain cannot form feedback loops or hold state.</p>
<!-- TODO: link to clock domains -->
</section>
<section id="assigning-to-signals">
<h3>Assigning to signals<a class="headerlink" href="#assigning-to-signals" title="Link to this heading">¶</a></h3>
<p><em>Assignments</em> are used to change the values of signals. An assignment statement can be introduced with the <code class="docutils literal notranslate"><span class="pre">.eq(...)</span></code> syntax:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">s</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">(eq (sig s) (const 1'd1))</span>
</pre></div>
</div>
<p>Similar to <a class="reference internal" href="#performing-or-describing-computations">how Torii operators work</a>, an Torii assignment is an ordinary Python object used to describe a part of a circuit. An assignment does not have any effect on the signal it changes until it is added to a control domain in a module. Once added, it introduces logic into the circuit generated from that module.</p>
</section>
<section id="assignment-targets">
<h3>Assignment targets<a class="headerlink" href="#assignment-targets" title="Link to this heading">¶</a></h3>
<p>The target of an assignment can be more complex than a single signal. It is possible to assign to any combination of <a class="reference internal" href="#signals">signals</a>, <a class="reference internal" href="#bit-sequence-operators">bit slices</a>, <a class="reference internal" href="#bit-sequence-operators">concatenations</a>, and <a class="reference internal" href="#bit-sequence-operators">part selects</a> as long as it includes no other values:</p>
<!-- TODO: mention arrays, records, user values -->
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">(eq (cat (sig a) (sig b)) (const 1'd0))</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">)</span>
<span class="go">(eq (slice (sig a) 0:4) (sig b))</span>
<span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a><span class="p">)</span><span class="o">.</span><span class="n">bit_select</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mb">0b11</span><span class="p">)</span>
<span class="go">(eq (part (cat (sig a) (sig a)) (sig b) 2 1) (const 2'd3))</span>
</pre></div>
</div>
</section>
<section id="assignment-domains">
<h3>Assignment domains<a class="headerlink" href="#assignment-domains" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">m.d.&lt;domain&gt;</span> <span class="pre">+=</span> <span class="pre">...</span></code> syntax is used to add assignments to a specific control domain in a module. It can add just a single assignment, or an entire sequence of them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">c</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="n">b</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">c</span></a><span class="p">),</span>
    <span class="n">c</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>If the name of a domain is not known upfront, the <code class="docutils literal notranslate"><span class="pre">m.d['&lt;domain&gt;']</span> <span class="pre">+=</span> <span class="pre">...</span></code> syntax can be used instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_toggle</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">t</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">'sync_</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="o">~</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">t</span></a><span class="p">)</span>
<span class="n">add_toggle</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Every signal included in the target of an assignment becomes a part of the domain, or equivalently, <em>driven</em> by that domain. A signal can be either undriven or driven by exactly one domain; it is an error to add two assignments to the same signal to two different domains:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">d</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">d</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">torii.hdl.dsl.SyntaxError</span>: <span class="n">Driver-driver conflict: trying to drive (sig d) from d.sync, but it is already driven from d.comb</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Clearly, Torii code that drives a single bit of a signal from two different domains does not describe a meaningful circuit. However, driving two different bits of a signal from two different domains does not inherently cause such a conflict. Would Torii accept the following code?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">e</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">e</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">e</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The answer is no. While this kind of code is occasionally useful, rejecting it greatly simplifies backends, simulators, and analyzers.</p>
</div>
</section>
<section id="assignment-order">
<h3>Assignment order<a class="headerlink" href="#assignment-order" title="Link to this heading">¶</a></h3>
<p>Unlike with two different domains, adding multiple assignments to the same signal to the same domain is well-defined.</p>
<p>Assignments to different signal bits apply independently. For example, the following two snippets are equivalent:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="p">[</span>
    <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
    <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
<p>If multiple assignments change the value of the same signal bits, the assignment that is added last determines the final value. For example, the following two snippets are equivalent:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="p">[</span>
    <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
    <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
    <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">b</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Cat" title="torii.hdl.ast.Cat"><span class="n">Cat</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Const" title="torii.hdl.ast.Const"><span class="n">Const</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<p>Multiple assignments to the same signal bits are more useful when combined with control structures, which can make some of the assignments <a class="reference internal" href="#active-and-inactive-assignments">active or inactive</a>. If all assignments to some signal bits are <a class="reference internal" href="#active-and-inactive-assignments">inactive</a>, their final values are determined by the signal’s domain, <a class="reference internal" href="#combinatorial-evaluation">combinatorial</a> or <a class="reference internal" href="#synchronous-evaluation">synchronous</a>.</p>
</section>
<section id="control-structures">
<h3>Control structures<a class="headerlink" href="#control-structures" title="Link to this heading">¶</a></h3>
<p>Although it is possible to write any decision tree as a combination of <a class="reference internal" href="#assigning-to-signals">assignments</a> and <a class="reference internal" href="#choice-operator">choice expressions</a>, Torii provides <em>control structures</em> tailored for this task: If, Switch, and FSM. The syntax of all control structures is based on <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#context-managers" title="(in Python v3.13)"><span class="xref std std-ref">context managers</span></a> and uses <code class="docutils literal notranslate"><span class="pre">with</span></code> blocks, for example:</p>
<!-- TODO: link to relevant subsections -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">Else</span><span class="p">():</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>While some Torii control structures are superficially similar to imperative control flow statements (such as Python’s <code class="docutils literal notranslate"><span class="pre">if</span></code>), their function—together with <a class="reference internal" href="#performing-or-describing-computations">expressions</a> and <a class="reference internal" href="#assigning-to-signals">assignments</a>—is to describe circuits. The code above is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Mux" title="torii.hdl.ast.Mux"><span class="n">Mux</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Because all branches of a decision tree affect the generated circuit, all of the Python code inside Torii control structures is always evaluated in the order in which it appears in the program. This can be observed through Python code with side effects, such as <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
    <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="s1">'inside `If`'</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">Else</span><span class="p">():</span>
    <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#print" title="print"><span class="nb">print</span></a><span class="p">(</span><span class="s1">'inside `Else`'</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">inside `If`</span>
<span class="go">inside `Else`</span>
</pre></div>
</div>
</section>
<section id="active-and-inactive-assignments">
<h3>Active and inactive assignments<a class="headerlink" href="#active-and-inactive-assignments" title="Link to this heading">¶</a></h3>
<p>An assignment added inside an Torii control structure, i.e. <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">m.&lt;...&gt;:</span></code> block, is <em>active</em> if the condition of the control structure is satisfied, and <em>inactive</em> otherwise. For any given set of conditions, the final value of every signal assigned in a module is the same as if the inactive assignments were removed and the active assignments were performed unconditionally, taking into account the <a class="reference internal" href="#assignment-order">assignment order</a>.</p>
<p>For example, there are two possible cases in the circuit generated from the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">timer</span> <span class="pre">==</span> <span class="pre">0</span></code> is true, the code reduces to:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">timer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Due to the <a class="reference internal" href="#assignment-order">assignment order</a>, it further reduces to:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">timer</span> <span class="pre">==</span> <span class="pre">0</span></code> is false, the code reduces to:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">timer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Combining these cases together, the code above is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">sync</span> <span class="o">+=</span> <span class="n">timer</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Mux" title="torii.hdl.ast.Mux"><span class="n">Mux</span></a><span class="p">(</span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">timer</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="combinatorial-evaluation">
<h3>Combinatorial evaluation<a class="headerlink" href="#combinatorial-evaluation" title="Link to this heading">¶</a></h3>
<p>Signals in the combinatorial <a class="reference internal" href="#control-domains">control domain</a> change whenever any value used to compute them changes. The final value of a combinatorial signal is equal to its <a class="reference internal" href="#initial-signal-values">initial value</a> updated by the <a class="reference internal" href="#active-and-inactive-assignments">active assignments</a> in the <a class="reference internal" href="#assignment-order">assignment order</a>. Combinatorial signals cannot hold any state.</p>
<p>Consider the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">a</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="../api/hdl/ast.html#torii.hdl.ast.Signal" title="torii.hdl.ast.Signal"><span class="n">Signal</span></a><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">m</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">en</span><span class="p">):</span>
    <span class="n">m</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">comb</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Whenever the signals <code class="docutils literal notranslate"><span class="pre">en</span></code> or <code class="docutils literal notranslate"><span class="pre">b</span></code> change, the signal <code class="docutils literal notranslate"><span class="pre">a</span></code> changes as well. If <code class="docutils literal notranslate"><span class="pre">en</span></code> is false, the final value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is its initial value, <code class="docutils literal notranslate"><span class="pre">1</span></code>. If <code class="docutils literal notranslate"><span class="pre">en</span></code> is true, the final value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<p>A combinatorial signal that is computed directly or indirectly based on its own value is a part of a <em>combinatorial feedback loop</em>, sometimes shortened to just <em>feedback loop</em>. Combinatorial feedback loops can be stable (i.e. implement a constant driver or a transparent latch), or unstable (i.e. implement a ring oscillator). Torii prohibits using assignments to describe any kind of a combinatorial feedback loop, including transparent latches.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current version of Torii does not detect combinatorial feedback loops, but processes the design under the assumption that there aren’t any. If the design does in fact contain a combinatorial feedback loop, it will likely be <strong>silently miscompiled</strong>, though some cases will be detected during synthesis or place &amp; route.</p>
<p>This hazard will be eliminated in the future.</p>
</div>
<!-- TODO: fix this, either as a part of https://github.com/amaranth-lang/amaranth/issues/6 or on its own -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the exceedingly rare case when a combinatorial feedback loop is desirable, it is possible to implement it by directly instantiating technology primitives (e.g. device-specific LUTs or latches). This is also the only way to introduce a combinatorial feedback loop with well-defined behavior in simulation and synthesis, regardless of the HDL being used.</p>
</div>
</section>
<section id="synchronous-evaluation">
<h3>Synchronous evaluation<a class="headerlink" href="#synchronous-evaluation" title="Link to this heading">¶</a></h3>
<p>Signals in synchronous <a class="reference internal" href="#control-domains">control domains</a> change whenever a specific transition (positive or negative edge) occurs on the clock of the synchronous domain. In addition, the signals in clock domains with an asynchronous reset change when such a reset is asserted. The final value of a synchronous signal is equal to its <a class="reference internal" href="#initial-signal-values">initial value</a> if the reset (of any type) is asserted, or to its current value updated by the <a class="reference internal" href="#active-and-inactive-assignments">active assignments</a> in the <a class="reference internal" href="#assignment-order">assignment order</a> otherwise. Synchronous signals always hold state.</p>
<!-- TODO: link to clock domains -->
</section>
</section>
</section>
<hr class="footnotes docutils"/>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id1" role="doc-backlink">1</a><span class="fn-bracket">]</span></span>
<p>Logical and arithmetic right shift of an unsigned value are equivalent. Logical right shift of a signed value can be expressed by <a class="reference internal" href="#conversion-operators">converting it to unsigned</a> first.</p>
</aside>
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a href="#id2" role="doc-backlink">1</a>,<a href="#id3" role="doc-backlink">2</a>)</span>
<p>Shift amount must be unsigned; integer shifts in Python require the amount to be positive.</p>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a href="#id4" role="doc-backlink">1</a>,<a href="#id5" role="doc-backlink">2</a>,<a href="#id6" role="doc-backlink">3</a>,<a href="#id7" role="doc-backlink">4</a>)</span>
<p>Shift and rotate amounts can be negative, in which case the direction is reversed.</p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a href="#id11" role="doc-backlink">1</a>,<a href="#id12" role="doc-backlink">2</a>)</span>
<p>Conceptually the same as applying the Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#all" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">all()</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/functions.html#any" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">any()</span></code></a> function to the value viewed as a collection of bits.</p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id13" role="doc-backlink">5</a><span class="fn-bracket">]</span></span>
<p>Conceptually the same as applying the Python <code class="xref py py-func docutils literal notranslate"><span class="pre">bool()</span></code> function to the value viewed as an integer.</p>
</aside>
<aside class="footnote brackets" id="id19" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id16" role="doc-backlink">6</a><span class="fn-bracket">]</span></span>
<p>Words “length” and “width” have the same meaning when talking about Torii values. Conventionally, “width” is used.</p>
</aside>
<aside class="footnote brackets" id="id20" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id17" role="doc-backlink">7</a><span class="fn-bracket">]</span></span>
<p>All variations of the Python slice notation are supported, including “extended slicing”. E.g. all of <code class="docutils literal notranslate"><span class="pre">a[0]</span></code>, <code class="docutils literal notranslate"><span class="pre">a[1:9]</span></code>, <code class="docutils literal notranslate"><span class="pre">a[2:]</span></code>, <code class="docutils literal notranslate"><span class="pre">a[:-2]</span></code>, <code class="docutils literal notranslate"><span class="pre">a[::-1]</span></code>, <code class="docutils literal notranslate"><span class="pre">a[0:8:2]</span></code> select bits in the same way as other Python sequence types select their elements.</p>
</aside>
<aside class="footnote brackets" id="id21" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a href="#id18" role="doc-backlink">8</a><span class="fn-bracket">]</span></span>
<p>In the concatenated value, <code class="docutils literal notranslate"><span class="pre">a</span></code> occupies the least significant bits, and <code class="docutils literal notranslate"><span class="pre">b</span></code> the most significant bits. An arbitrary number of arguments for <code class="docutils literal notranslate"><span class="pre">Cat</span></code> is supported.</p>
</aside>
</aside>
<script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>
</article>
</div>
<footer>
<div class="related-pages">
<a class="next-page" href="../api/index.html">
<div class="page-info">
<div class="context">
<span>Next</span>
</div>
<div class="title">API Reference</div>
</div>
<svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
</a>
<a class="prev-page" href="../tutorials/external_modules.html">
<svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
<div class="page-info">
<div class="context">
<span>Previous</span>
</div>
<div class="title">Including External non-Torii Modules</div>
</div>
</a>
</div>
<div class="bottom-of-page">
<div class="left-details">
<div class="copyright">
                Copyright © 2025 Shrine Maiden Heavy Industries and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
</div>
<div class="right-details">
</div>
</div>
</footer>
</div>
<aside class="toc-drawer">
<div class="toc-sticky toc-scroll">
<div class="toc-title-container">
<span class="toc-title">
            On this page
          </span>
</div>
<div class="toc-tree-container">
<div class="toc-tree">
<ul>
<li><a class="reference internal" href="#">Language Guide</a><ul>
<li><a class="reference internal" href="#the-prelude">The prelude</a></li>
<li><a class="reference internal" href="#shapes">Shapes</a></li>
<li><a class="reference internal" href="#shapes-of-values">Shapes of values</a></li>
<li><a class="reference internal" href="#values">Values</a></li>
<li><a class="reference internal" href="#constants">Constants</a></li>
<li><a class="reference internal" href="#shape-casting">Shape casting</a><ul>
<li><a class="reference internal" href="#shapes-from-integers">Shapes from integers</a></li>
<li><a class="reference internal" href="#shapes-from-ranges">Shapes from ranges</a></li>
<li><a class="reference internal" href="#shapes-from-enumerations">Shapes from enumerations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#value-casting">Value casting</a><ul>
<li><a class="reference internal" href="#values-from-integers">Values from integers</a></li>
<li><a class="reference internal" href="#values-from-enumeration-members">Values from enumeration members</a></li>
</ul>
</li>
<li><a class="reference internal" href="#constant-casting">Constant casting</a></li>
<li><a class="reference internal" href="#signals">Signals</a><ul>
<li><a class="reference internal" href="#signal-shapes">Signal shapes</a></li>
<li><a class="reference internal" href="#signal-names">Signal names</a></li>
<li><a class="reference internal" href="#initial-signal-values">Initial signal values</a></li>
<li><a class="reference internal" href="#reset-less-signals">Reset-less signals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#operators">Operators</a><ul>
<li><a class="reference internal" href="#performing-or-describing-computations">Performing or describing computations?</a></li>
<li><a class="reference internal" href="#width-extension">Width extension</a></li>
<li><a class="reference internal" href="#arithmetic-operators">Arithmetic operators</a></li>
<li><a class="reference internal" href="#comparison-operators">Comparison operators</a></li>
<li><a class="reference internal" href="#bitwise-shift-and-rotate-operators">Bitwise, shift, and rotate operators</a></li>
<li><a class="reference internal" href="#reduction-operators">Reduction operators</a></li>
<li><a class="reference internal" href="#logical-operators">Logical operators</a></li>
<li><a class="reference internal" href="#bit-sequence-operators">Bit sequence operators</a></li>
<li><a class="reference internal" href="#conversion-operators">Conversion operators</a></li>
<li><a class="reference internal" href="#choice-operator">Choice operator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modules">Modules</a><ul>
<li><a class="reference internal" href="#control-domains">Control domains</a></li>
<li><a class="reference internal" href="#assigning-to-signals">Assigning to signals</a></li>
<li><a class="reference internal" href="#assignment-targets">Assignment targets</a></li>
<li><a class="reference internal" href="#assignment-domains">Assignment domains</a></li>
<li><a class="reference internal" href="#assignment-order">Assignment order</a></li>
<li><a class="reference internal" href="#control-structures">Control structures</a></li>
<li><a class="reference internal" href="#active-and-inactive-assignments">Active and inactive assignments</a></li>
<li><a class="reference internal" href="#combinatorial-evaluation">Combinatorial evaluation</a></li>
<li><a class="reference internal" href="#synchronous-evaluation">Synchronous evaluation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</aside>
</div>
</div><script src="../_static/documentation_options.js?v=3a9f889b"></script>
<script src="../_static/doctools.js?v=9bcbadda"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../_static/scripts/furo.js?v=46bd48cc"></script>
<script src="../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../_static/copybutton.js?v=f281be69"></script>
<script src="../_static/tabs.js?v=3ee01567"></script>
<script src="../_static/wavedrom.skin.js"></script>
<script src="../_static/wavedrom.min.js"></script>
<script src="../_static/js/wavedrom.min.js?v=912bf3a3"></script>
<script src="../_static/js/wavedrom.skin.js?v=be5c2381"></script>
</body>
</html>